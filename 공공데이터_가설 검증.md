```python

```

## 가설

- 음주 여부에 따라 건강검진 수치 차이가 있을까?
- 신장과 허리둘레의 크기는 체중과 상관관계가 있을까?

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/corazzon/boostcourse-ds-510/blob/master/health_analysis-output.ipynb)


* 분석을 통해 가설을 검정해 봅니다.

## 라이브러리 로드


```python
# 분석에 사용할 pandas, 수치계산에 사용할 numpy, 시각화에 사용할 seaborn 을 불러옵니다.
# 또, 구 버전의 주피터 노트북에서는 %matplotlib inline 설정을 되어야 노트북 안에서 그래프를 시각화 합니다.

import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt

%matplotlib inline
```

## 한글폰트 설정


```python
# 한글폰트를 설정해 주지 않으면 그래프 상에서 한글이 깨져보입니다.
# 한글이 출력될 수 있도록 폰트 설정을 해줍니다.
# 운영체제별 설정을 위해 로드 합니다.
import os

# 윈도우, 맥 외의 OS는 별도로 설정해 주세요.
if os.name == 'posix':
    plt.rc("font", family="AppleGothic")
else:
    plt.rc("font", family="Malgun Gothic")
# 마이너스 폰트 깨지는 문제에 대한 대처
plt.rc("axes", unicode_minus=False)


# 레티나 설정을 해주면 글씨가 좀 더 선명하게 보입니다.
# 폰트의 주변이 흐릿하게 보이는 것을 방지합니다.


%config InlineBackend.figure_format = 'retina'
```

## 데이터 불러오기


-  음주여부 Y/N 1 > 0 으로 변경 해야 함

* 건강검진정보란 국민건강보험의 직장가입자와 40세 이상의 피부양자, 세대주인 지역가입자와 40세 이상의 지역가입자의 일반건강검진 결과와 이들 일반건강검진 대상자 중에 만40세와 만66세에 도달한 이들이 받게 되는 생애전환기건강진단 수검이력이 있는 각 연도별 수진자 100만 명에 대한 기본정보(성, 연령대, 시도코드 등)와 검진내역(신장, 체중, 총콜레스테롤, 혈색소 등)으로 구성된 개방데이터입니다.

<img src="https://i.imgur.com/Twtlh6W.png">

<img src="https://i.imgur.com/GJqg05v.png">


공공데이터 개방서비스( http://nhiss.nhis.or.kr/op/it/index.do )에서도 다운로드 받을 수 있음.

* 건강검진정보(2017) 다운로드 받기 : https://www.data.go.kr/dataset/15007122/fileData.do
* 2018년 데이터로 실습을 하셔도 됩니다. 다만 encoding과 컬럼명이 달라서 2018년 데이터에 맞게 고쳐주시면 됩니다.
* 2018년 외 다른 연도의 데이터로도 실습을 하고자 한다면 컬럼명과 인코딩에 주의해 주세요.


```python
# 다운로드 받은 파일을 판다스의 read_csv 를 통해 읽어옵니다.
# 파일을 읽어온 후 shape 로 행과 열의 수를 출력합니다.
# utf-8 인코딩이 되어 있는 파일을 불러올 때는 encoding 옵션을 사용합니다.
# euc-kr 2350개 글자를 표현하고, cp949는 11124개 글자를 표현합니다.

# df = pd.read_csv("data/NHIS_OPEN_GJ_2017.CSV", encoding="euc-kr")

df = pd.read_csv("data/NHIS_OPEN_GJ_2017.CSV", encoding="cp949")
df.shape
```

### 데이터 미리보기


```python
# sample, head, tail을 통해 데이터를 미리보기 합니다.
df.head()
```


```python
df.tail()
```


```python
df.sample()
```

## 기본정보 보기


```python
# info를 통해 데이터의 크기, 형식, 메모리 사용량 등을 봅니다.
df.info()
```

###  df.info( ) result


- 이 데이터는 259MB 크기를 갖고 있습니다. 

- 메모리는 데이터 타입, 결측치, 문자가 어떤 길이로 들어가는지에 따라 달라집니다.

- int를 float으로 변경하면 줄어들기도 합니다. 

- 메모리가 부족하다면 불필요한 브라우저창을 닫아주세요. 결측치를 줄여줘도 메모리도 줄어듭니다.



```python
# 컬럼의 수 34, 컬럼만 따로 출력합니다.

df.columns
```


```python
# dtypes 를 통해 데이터 형식만 출력합니다.

df.dtypes
```

## 결측치 보기


```python
# isnull() 을 통해 결측치를 bool 값으로 True로 표시하고,
# sum()을 하면 컬럼마다의 결측치 수를 세어줍니다.

df.isnull().sum()
```


```python
# isna로도 결측치 여부를 확인하고 sum을 통해 결측치 수를 집계할 수 있습니다.

df.isna().sum()
```


```python
# 판다스에 내장 된 plot을 통해 시각화를 합니다.
# bar'h'로 글씨를 y축에 두고 figsize 옵션으로 사이즈를 조절

df.isnull().sum().plot.barh(figsize=(10, 9))
```

## 일부 데이터 요약하기

- 1개의 열을 가져올 때는 series 형태의 데이터 구조로 결과가 나타나고, 
- 2개 이상의 열(리스트 형태)을 가져올 때는 dataframe 형태의 데이터 구조로 가져옵니다.


```python
# 여러 컬럼을 가져옵니다. 이때는 컬럼을 리스트로 묶어야 합니다.
# "(혈청지오티)ALT", "(혈청지오티)AST" 를 가져와 미리보기 합니다.

df[["(혈청지오티)ALT", "(혈청지오티)AST"]].head()
```


```python
# describe()를 통해 수치형 데이터 "(혈청지오티)ALT", "(혈청지오티)AST" 를 요약합니다.

df[["(혈청지오티)ALT", "(혈청지오티)AST"]].describe()
```

### describe( ) result

- 결측치를 제외한 count 값,  mean 값(평균), std 값(표준편차), min 값(최소값), max 값(최대값), 50%(중앙값, 2사분위수), 25%(1사분위수), 75%(3사분위수)를 집계하여 보여줍니다.


- 중앙값에 비해 평균값이 높다는 걸 알 수 있습니다. 
- 현재 평균값은 max 값에 의해 영향을 많이 받고 있습니다. 
- min,max 에서 이상치가 있습니다.


## value_counts 로 값 집계하기

- value_counts()로 category나 text 형태 데이터의 빈도수를 체크할 수 있습니다.




```python
# category형 데이터 "성별코드 "를 그룹화 하고, value_counts 를 통해 갯수를 집계합니다.

df["성별코드"].value_counts()
```


```python
# 1은 흡연하지 않는 사람, 2는 흡연하는 사람, 3은 흡연했지만 금연한 사람
# "흡연상태 "로 그룹화 하고 value_counts 를 통해 갯수를 집계합니다.

df["흡연상태"].value_counts()
```

## groupby 와 pivot_table 사용하기

- 2개 이상의 데이터를 보기 위해서 groupby와 pivot_table을 사용합니다.



- df.groupby([""])["value"].count()
- df.groupby([""])["value"].mean()
- df.groupby([""])["value"].describe()
 
 
- df.groupby([""])["value"].agg(["","",""])



### groupby


```python
# 성별코드 값에 따라 모든 열에 대한 평균

df.groupby(["성별코드"]).mean()

```


```python
# groupby를 통해 데이터를 그룹화 합니다.

# "성별코드"로 그룹화 후 key 데이터 "가입자일련번호"를 세어 봅니다.

df.groupby(["성별코드"])["가입자일련번호"].count()
```


```python
# 성별코드와 음주여부로 그룹화를 하고 갯수를 세어 봅니다.

df.groupby(["성별코드", "음주여부"])["가입자일련번호"].count()
```


```python
# 감마지피티는 간수치에 관련된 데이터입니다.
# 성별코드와 음주여부로 그룹화를 하고 감마지티피의 평균을 구합니다.
# 음주하고 있는 사람들이 감마지티피 수치가 더 높게 나옴을 알 수 있습니다.



df.groupby(["성별코드", "음주여부"])["감마지티피"].mean()
```


```python
# 성별코드와 음주여부로 그룹화를 하고 감마지티피의 요약수치를 구합니다.

# max가 999인 이유를 공공데이터포털에서 알아보시기 바랍니다.
# max 값 때문에 평균값이 편향되었다는 사실을 알 수 있습니다.

df.groupby(["성별코드", "음주여부"])["감마지티피"].describe()
```


```python
# agg을 사용하면 여러 수치를 함께 구할 수 있습니다.

df.groupby(["성별코드", "음주여부"])["감마지티피"].agg(["count", "mean", "median"])
```

### pivot_table
* https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html


- df.pivot_table(index,value,aggfunc)


- pivot은 연산을 하지 않고, 데이터의 구조를 바꾸고자 할 때 사용합니다.


- pivot_table의 연산 속도가 groupby보다 빠르고, 사용 방법이 직관적입니다.




```python
# 음주여부에 따른 그룹화된 수를 피봇테이블로 구합니다.

df.pivot_table(index="음주여부", values="가입자일련번호", aggfunc="count")
```


```python
# 음주여부에 따른 감마지티피의 평균(default) 을 구합니다.

pd.pivot_table(df, index="음주여부", values="감마지티피")
```


```python
# 기본값은 평균을 구하지만 aggfunc을 통해 지정해 줄 수도 있습니다.

pd.pivot_table(df, index="음주여부", values="감마지티피", aggfunc='mean')
```


```python
# aggfunc에 여러 값을 한번에 지정할 수도 있습니다.

pd.pivot_table(df, index="음주여부", values="감마지티피", aggfunc=["mean", "median"])
```


```python
# aggfunc에 describe() 를 사용해 통계 요약 값(세부 값)을 한번에 볼 수도 있습니다.

pd.pivot_table(df, index="음주여부", values="감마지티피", aggfunc="describe")
```


```python
# 성별코드, 음주여부에 따른 감마지티피 값의 평균을 구합니다.

pd.pivot_table(df, index=["성별코드", "음주여부"], values="감마지티피", aggfunc="describe")
```

## 전체 데이터 시각화 


* 100만개가 넘는 데이터를 시각화할 때는 되도록이면 groupby 혹은 pivot_table로 연산을 하고 시각화를 하는 것을 권장합니다.
* 100만개가 넘는 데이터를 seaborn과 같은 고급 통계 연산을 하는 그래프를 사용하게 되면 많이 느릴 수 있습니다.

### 히스토그램

* 판다스의 df.info() 기능을 통해 대부분 수치 데이터(flaot, int)로 이루어 진것을 확인할 수 있었습니다. 


* 히스토그램을 사용하면 __수치데이터를 bin 의 갯수만큼 그룹화 해서 도수분포표를 만들고 그 결과를 시각화__ 합니다.


* __히스토그램은 연속된 데이터를 카테고리형 으로 만듭니다.__ 
* 이 데이터에는 __수치데이터가 많기 때문에__ 판다스의 hist를 사용해서 히스토그램을 그립니다.


        - https://ko.wikipedia.org/wiki/%EB%8F%84%EC%88%98_%EB%B6%84%ED%8F%AC
        - https://ko.wikipedia.org/wiki/%ED%9E%88%EC%8A%A4%ED%86%A0%EA%B7%B8%EB%9E%A8



```python
# 전체 데이터에 대한 히스토그램을 출력합니다.

h = df.hist(figsize=(16, 16))
```

### 슬라이싱을 사용해 히스토그램 시각화


* 슬라이싱 기능을 사용해서 데이터를 나누어 그립니다.
* 슬라이싱 사용시 iloc를 활용하면 인덱스의 순서대로 슬라이싱이 가능합니다.


* iloc[행, 열] 순으로 인덱스를 써주면 해당 인덱스만 불러오며, 전체 데이터를 가져오고자 할 때는 [:, :]을 사용합니다.
* 슬라이싱을 해주는 대괄호 안의 콜론 앞뒤에 숫자를 써주게 되면 해당 시작인덱스:끝나는인덱스(+1)를 지정할 수 있습니다.


```python
# 슬라이싱을 사용해 앞에서 12개 컬럼에 대한 데이터로 히스토그램을 그립니다.
# [행, 열]

# [전체행, 0~11+1] 열로 index 11까지 (12개)

h = df.iloc[:, :12].hist(figsize=(12, 12))
```


```python
# 슬라이싱을 사용해 앞에서 12번째부터 23번째까지(12:24) 컬럼에 대한 데이터로 히스토그램을 그립니다.
# bins 옵션으로 막대의 개수를 잘게 그립니다.
h = df.iloc[:, 12:24].hist(figsize=(12, 12), bins=100)
```


```python
# 슬라이싱을 사용해 앞에서 24번째부터 마지막까지(24:) 컬럼에 대한 데이터로 히스토그램을 그립니다.

h = df.iloc[:, 24:].hist(figsize=(12, 12), bins=10)
```

## 샘플데이터 추출하기


* __seaborn 의 그래프는 내부에서 수학적 연산이 되기 때문에 데이터가 많으면 속도가 오래 걸립니다.__

* 따라서 전체 데이터를 사용하면 너무 느리기 때문에, __일부만 샘플링해서 사용합니다.__


```python
# df.sample을 통해 일부 데이터만 샘플데이터만 추출합니다. 

# 실험을 통제하기 위해 random_state를 고정하기도 합니다. random_state 를 사용해 샘플링되는 값을 고정할 수 있습니다.
# random_state 값은 높든 낮든 상관 없이 값을 고정시키는 역할만 합니다.

df_sample = df.sample(1000, random_state=1)
df_sample.shape
```

## seaborn ( 데이터 시각화 도구 )
        
        - https://seaborn.pydata.org/
        
        
- __seaborn 은 https://matplotlib.org/ 을 사용하기 쉽게 만들어 졌으며, 간단하게 고급 통계 연산을 할 수 있습니다.__

- 범주형 데이터, 수치형 데이터에 따라 시각화에 접근하는 방식이 달라집니다.

## 범주형(카테고리) 데이터 시각화


* countplot은 범주형 데이터의 수를 더한 값을 그래프로 표현합니다.
* value_counts 로 구한 값을 시각화 한다고 보면 됩니다.


- df[].value_counts().plot.bar()
- sns.countplot(data,x)

### countplot - 음주여부


```python
# pandas 제공 기본 plot 음주 여부에 따른 counts().plot.bar() 을 그립니다.
# df 그룹화와 연산 과정을 처리해야함. 

df["음주여부"].value_counts().plot.bar(rot=30)
```


```python
# seaborn 음주여부에 따른 countplot을 그립니다.

sns.countplot(data=df,x="음주여부")
```

### hue 옵션 사용하기


```python
# seaborn 에서 제공하는 폰트 설정
sns.set(font_scale=1, font="AppleGothic")

# 음주여부에 따른 countplot을 그리고 hue 를 사용해 성별코드로 색상을 구분

sns.countplot(data=df, x="음주여부", hue="성별코드")
```


```python
# countplot으로 연령대별 음주여부를 봅니다.
# hue를 사용해 다른 색상으로 표현합니다.

plt.figure(figsize=(15, 4))

sns.countplot(data=df, x="연령대코드(5세단위)", hue="음주여부")
```

### countplot (data, x, // y)

* 키와 몸무게는 연속형 데이터 라고 볼 수 있습니다. 
* 하지만 이 데이터는 키는 5cm, 체중은 5kg __단위__로 되어 있습니다. 이렇게 __연속형 데이터가 특정 범위로 묶게 되면 범주형 데이터로 해석__할 수 있습니다.


- 연속형 데이터는 bin으로 특정 범위로 묶은 후 count


```python
# counplot으로 키를 봅니다.

plt.figure(figsize=(15, 4))

sns.countplot(data=df, x="신장(5Cm단위)")

```


```python
# counplot으로 체중을 봅니다.

plt.figure(figsize=(15, 4))
sns.countplot(data=df, x="체중(5Kg단위)")
```


```python
# 성별에 따른 키의 차이를 봅니다. 

plt.figure(figsize=(15, 4))
sns.countplot(data=df, x="신장(5Cm단위)", hue="성별코드")
```


```python
# 성별에 따른 체중의 차이를 봅니다.

plt.figure(figsize=(15, 4))
sns.countplot(data=df, x="체중(5Kg단위)", hue="성별코드")
```


```python
# 음주여부에 따라 체중의 차이를 확인
# Y 확인, 음주를 한다면 체중이 대체로 많이 나감을 그래프에서 확인

plt.figure(figsize=(15,4))

sns.countplot(data=df, x="체중(5Kg단위)", hue="음주여부")

```

### barplot - 수치형 vs 범주형 데이터 시각화


```python

# 연령대코드와 총 콜레스테롤을 봅니다.
# hue 로 색상을 다르게 표현할 수 있습니다. 음주여부를 함께 봅니다.

plt.figure(figsize=(15,4))
sns.barplot(data=df_sample, x="연령대코드(5세단위)", y="총콜레스테롤", hue="음주여부")
```


```python
# 연령대코드와 총 콜레스테롤을 봅니다.
# 콜레스테롤과 연령대코드(5세단위)를 흡연상태에 따라 barplot으로 그립니다.

plt.figure(figsize=(15, 4))
sns.barplot(data=df_sample, x="연령대코드(5세단위)", y="총콜레스테롤", hue="흡연상태")
```

#### 신뢰구간 


        -https://ko.wikipedia.org/wiki/%EC%8B%A0%EB%A2%B0_%EA%B5%AC%EA%B0%84


```python
# 트리글리세라이드(중성지방) 에 따른 연령대코드(5세단위)를 음주여부에 따라 barplot으로 그립니다.
# ci 신뢰구간 95 
# 음주를 하는 사람이 트리글리세라이드(중성지방수치)가 높은 경향이 있습니다.


plt.figure(figsize=(15, 4))
sns.barplot(data=df, x="연령대코드(5세단위)", y="트리글리세라이드", hue="음주여부", ci=95)
```


```python
# 연령대코드와 체중(5Kg 단위)을 성별에 따라 봅니다.


plt.figure(figsize=(15, 4))
sns.barplot(data=df, x="연령대코드(5세단위)", y="체중(5Kg단위)", hue="성별코드", ci=None)
```


```python
# 연령대코드(5세단위) 에 따른 체중(5Kg 단위) 을 "음주여부 "에 따라 barplot으로 그립니다.

plt.figure(figsize=(15, 4))

sns.barplot(data=df, x="연령대코드(5세단위)", y="체중(5Kg단위)", hue="음주여부", ci="sd")
```

### lineplot and pointplot


```python
# 연령대코드(5세단위) 에 따른 체중(5Kg 단위) 을 성별코드에 따라 lineplot으로 그립니다.
# 연령대가 높아질수록 체중이 낮아진다는 것을 볼 수 있습니다.

# lineplot은 편차와 신뢰구간을 그림자로 표현합니다. 
# 그래프 뒤쪽에 그림자가 없는 이유는 모수가 적어서 편차를 그릴 게 없기 때문입니다.


plt.figure(figsize=(15, 4))
sns.lineplot(data=df_sample, x="연령대코드(5세단위)", y="체중(5Kg단위)", hue="성별코드", ci="sd")
```


```python
# 연령대코드(5세단위) 에 따른 신장(5Cm단위) 을 성별코드에 따라 lineplot으로 그립니다.
# 나이가 커질수록 신장이 조금씩 작아집니다.

plt.figure(figsize=(15, 4))
sns.lineplot(data=df_sample, x="연령대코드(5세단위)", y="신장(5Cm단위)", hue="성별코드", ci="sd")
```


```python
# 연령대코드(5세단위) 에 따른 체중(5Kg 단위) 을 음주여부에 따라 pointplot과 barplot으로 그립니다.
# 키는 음주하고 있는 사람들이 약간 더 큰 편입니다.



plt.figure(figsize=(15, 4))
sns.barplot(data=df_sample, x="연령대코드(5세단위)", y="신장(5Cm단위)", hue="음주여부", ci="sd")


```


```python
# pointplot은 막대를 통해 편차와 신뢰구간를 표현합니다.


plt.figure(figsize=(15, 4))

sns.pointplot(data=df_sample, x="연령대코드(5세단위)", y="신장(5Cm단위)", hue="음주여부", ci="sd")
```


```python
# 연령대코드(5세단위) 에 따른 신장(5Cm단위) 을 성별코드에 따라 pointplot으로 그립니다.

plt.figure(figsize=(15, 4))
sns.pointplot(data=df_sample, x="연령대코드(5세단위)", y="신장(5Cm단위)", hue="성별코드", ci="sd")
```


```python
# 연령대코드(5세단위) 에 따른 혈색소를 음주여부에 따라 lineplot으로 그립니다.
# 연령대가 높아질수록 혈색소가 줄어들고 있습니다.
# 음주를 하면 혈색소가 평균적으로 더 높습니다.

plt.figure(figsize=(15, 4))
sns.lineplot(data=df, x="연령대코드(5세단위)", y="혈색소", hue="음주여부", ci=None)
```

#### 그래프 겹쳐 그리기


```python
plt.figure(figsize=(15,4))
sns.lineplot(data=df, x="연령대코드(5세단위)", y="신장(5Cm단위)", hue="음주여부", ci="sd")
sns.pointplot(data=df, x="연령대코드(5세단위)", y="신장(5Cm단위)", hue="음주여부", ci="sd")
```


```python
plt.figure(figsize=(15,4))

sns.barplot(data=df, x="연령대코드(5세단위)", y="신장(5Cm단위)", hue="음주여부", ci="sd")
sns.pointplot(data=df, x="연령대코드(5세단위)", y="신장(5Cm단위)", hue="음주여부", ci="sd")
```

 

- __barplot은 막대로 개별값을 표현하는데__ 

- __lineplot, pointplot을 통해서는 선으로 기울기까지 표현할 수 있습니다.__ 

- __가격 데이터, 매출/재고 데이터는 대체로 lineplot, pointplot으로 그리는 것이 좋습니다.__

### boxplot


- __boxplot 을 그리면 이상치를 확인__하기 좋습니다. 




* https://pandas.pydata.org/pandas-docs/stable/user_guide/visualization.html
* https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.boxplot.html



* [상자 수염 그림 - 위키백과, 우리 모두의 백과사전](https://ko.wikipedia.org/wiki/%EC%83%81%EC%9E%90_%EC%88%98%EC%97%BC_%EA%B7%B8%EB%A6%BC)
* 가공하지 않은 자료 그대로를 이용하여 그린 것이 아니라, 자료로부터 얻어낸 통계량인 5가지 요약 수치로 그린다.
* 5가지 요약 수치란 기술통계학에서 자료의 정보를 알려주는 아래의 다섯 가지 수치를 의미한다.


1. 최솟값
1. 제 1사분위수
1. 제 2사분위수( ), 즉 중앙값
1. 제 3 사분위 수( )
1. 최댓값

* Box plot 이해하기 : 
    * [박스 플롯에 대하여 :: -[|]- Box and Whisker](https://boxnwhis.kr/2019/02/19/boxplot.html)
    * [Understanding Boxplots – Towards Data Science](https://towardsdatascience.com/understanding-boxplots-5e2df7bcbd51)
    
  
사분위수 범위(IQR)은 3사분위수 - 1사분위수입니다. 


3사분위수보다 1.5 x IQR 이상을 초과하는 값과 Q1보다 1.5 x IQR 이상 미달하는 값은 이상치입니다. 점, 원, 별표 모양으로 표현합니다.


```python
# boxplot으로 신장(5Cm단위)에 따른 체중(5Kg단위) 을 그리며,
# 성별코드 에 따라 다른 색상으로 표현되게 합니다.

plt.figure(figsize=(15, 4))
sns.boxplot(data=df, x="신장(5Cm단위)", y="체중(5Kg단위)", hue="성별코드")
```

### violinplot

- __boxplot의 단점을 보완__하여 더 자세하게 보여주는 그래프입니다.




```python
# df.sample 데이터로 변경
# violinplot 신장(5Cm단위)에 따른 체중(5Kg 단위) 을 그리며, 
# 음주여부에 따라 다른 색상으로 표현되게 합니다.

plt.figure(figsize=(15, 4))
sns.violinplot(data=df_sample, x="신장(5Cm단위)", y="체중(5Kg단위)", hue="음주여부")
```


```python
# violinplot의 split 기능을 사용해 봅니다. 
# split 옵션을 이용하면 두 개의 데이터(Y,N)를 붙여서 볼 수 있습니다.


plt.figure(figsize=(15, 4))
sns.violinplot(data=df_sample, x="신장(5Cm단위)", y="체중(5Kg단위)", hue="음주여부", split=True)
```


```python
# violinplot 연령대코드(5세단위)에 따른 혈색소를 그리며, 음주여부에 따라 다른 색상으로 표현되게 합니다.
# x축의 16에서 보면 음주하는 사람들의 값이 확연히 높고, 전체적으로 더 위에 분포하는 것을 볼 수 있습니다.


plt.figure(figsize=(15, 4))
sns.violinplot(data=df_sample, x="연령대코드(5세단위)", y="혈색소", hue="음주여부", split=True)
```

### swarm plot
* 범주형 데이터를 산점도로 시각화하고자 할 때 사용합니다.


```python
# swarmplot으로 신장(5Cm단위)에 따른 체중(5Kg 단위) 을 그리며, 음주여부에 따라 다른 색상으로 표현되게 합니다.
# 점을 하나씩 찍기 때문에 오래 걸리는 코드는 전체로 그려보기 전에 일부만 가져와 그려봅니다.

plt.figure(figsize=(15, 4))
sns.swarmplot(data=df_sample, x="신장(5Cm단위)", y="체중(5Kg단위)", hue="음주여부")
```


```python
# swarmplot으로 연령대코드(5세단위)에 따른 음주여부 그리며, 성별코드에 따라 다른 색상으로 표현되게 합니다.
# 점을 하나씩 찍기 때문에 오래 걸리는 코드는 전체로 그려보기 전에 일부만 가져와 그려봅니다.

plt.figure(figsize=(15, 4))
sns.swarmplot(data=df_sample, x="연령대코드(5세단위)", y="혈색소", hue="음주여부")
```

### lmplot

- scatterplot과는 다르게 회귀선을 확인해볼 수 있습니다.
- col이란 옵션으로 데이터를 분류하여 볼 수 있습니다.

- lmplot은 회귀선을 그리거나 다변수 시각화를 할 때 좋습니다.


violinplot은 분포를 더 자세히 볼 수 있습니다.


```python
# lmplot 시각화

sns.lmplot(data=df_sample, x="연령대코드(5세단위)", y="혈색소", hue="음주여부", col="성별코드")
```

## 수치형 데이터 시각화

### scatterplot - 산점도
* 수치형 vs 수치형 데이터의 상관 관계를 볼 때 주로 사용합니다.
* __점의 크기를 데이터의 수치에 따라 다르게 볼 수 있습니다.__
- scatterplot을 활용하면 그래프의 이상치를 파악하기 쉽습니다.


```python
# scatterplot 으로 "(혈청지오티)AST", "(혈청지오티)ALT" 을 그리고 음주여부에 따라 다른 색상으로 표현되게 합니다.
# 음주여부에 따라 차이가 있는지 확인
# size라는 옵션으로 체중에 따라 크기를 다르게 지정

plt.figure(figsize=(8, 7))
sns.scatterplot(data=df_sample, x="(혈청지오티)AST", y="(혈청지오티)ALT", hue="음주여부", size="체중(5Kg단위)")
```


```python
plt.figure(figsize=(8, 7))
sns.scatterplot(data=df_sample, x="(혈청지오티)AST", y="(혈청지오티)ALT", hue="허리둘레")
```

### lmplot - 상관 관계를 보기

- lmplot으로 상관 관계를 더 잘 파악할 수 있습니다.
- 그리드처럼 격자로 나옵니다. categorical 데이터로 인식하기 때문입니다.




```python
# lmplot 으로 신장(5Cm단위)에 따른 체중(5Kg 단위) 을 그리며, 음주여부에 따라 다른 색상으로 표현되게 합니다.

sns.lmplot(data=df_sample, x="신장(5Cm단위)", y="체중(5Kg단위)", hue="음주여부", col="성별코드")
```


```python
# lmplot의 col기능을 통해 음주여부에 따라 서브플롯을 그려봅니다. 
# 여러 카테고리 값에 따라 subplot을 그릴 수 있다는 것이 장점입니다.

sns.lmplot(data=df_sample, x="신장(5Cm단위)", y="체중(5Kg단위)", hue="성별코드", col="음주여부")
```


```python
# lmplot 으로 수축기, 이완기혈압을 그리고 음주여부에 따라 다른 색상으로 표현되게 합니다.
# 두 특성은 강한 상관관계를 보입니다.
sns.lmplot(data=df_sample, x="수축기혈압", y="이완기혈압", hue="음주여부")
```

`AST와 ALT`
* 출처 : https://sev.iseverance.com/dept_clinic/center/liver/treatment/view.asp?con_no=87827


```
AST와 ALT는 간세포에 들어 있는 효소 입니다.

간이 손상돼 간세포가 파괴되면 그 안에 있던 AST와 ALT 가 빠져 나와 혈액 속에 섞여 돌아다니게 됩니다. 
따라서 간이 손상되면 AST와 ALT 수치가 높아집니다.

정상 수치는 병원에 따라 기준치가 다소 차이가 있으나 AST가 5~35 IU/L, ALT가 5~40 IU/L 정도 입니다.

 

간혹 전날 술을 마시거나 몸이 피곤하면 일시적으로 AST와 ALT 수치가 정상치를 웃돌 수 있으므로 딱 한 번의 검사만으로 간질환 여부를 판단하는 경우는 드뭅니다. 하지만 AST 와 ALT 같은 간수치는 간의 상태를 일차적으로 파악하는데 아주 중요한 기준이 됩니다.
```


```python
# lmplot으로 "(혈청지오티)AST", "(혈청지오티)ALT" 을 그리고 음주여부에 따라 다른 색상으로 표현되게 합니다.
# robust라는 옵션을 활용하면 이상치를 빼고 그립니다. 
# 이상치가 있으면 회귀선이 영향을 많이 받으므로 robust 옵션을 사용해주는 것이 좋습니다.


# seaborn 의 장점은 값만 넣어주면 그래프를 자동으로 그려준다는 것입니다. 
# seaborn 의 단점은 속도가 오래 걸립니다.


# 음주여부에 따라서도 차이가 있지만 이상치가 있습니다.

sns.lmplot(data=df_sample, x="(혈청지오티)AST", y="(혈청지오티)ALT", hue="음주여부", robust=True)
```

### Outliars 이상치 다루기

* __이상치가 있으면 데이터가 자세히 보이지 않거나 이상치로 인해 회귀선이 달라지기도 합니다.__
* __시각화를 통해 찾은 이상치를 제거하고 보거나 이상치만 따로 모아 보도록 합니다.__


```python

# 범위를 지정하여 데이터셋을 만들어줍니다.

# "(혈청지오티)AST" 와 "(혈청지오티)ALT" 가 모두 400 이하인 값만
# logical 데이터프레임 형태로 추출해서 df_ASLT 라는 변수에 담습니다.


df_ASLT = df_sample[(df_sample["(혈청지오티)AST"] < 400) & (df_sample["(혈청지오티)ALT"] < 400)]
```


```python
# 이상치를 제거한 "(혈청지오티)AST" 와 "(혈청지오티)ALT" 를 lmplot으로 그리며 
# 음주여부에 따라 다른 색으로 표현합니다.

sns.lmplot(data=df_ASLT,  x="(혈청지오티)AST", y="(혈청지오티)ALT", hue="음주여부", ci=None)
```


```python
# AST와 ALT의 이상치들만 모은 데이터를 만듭니다.
# "(혈청지오티)AST" 또는 "(혈청지오티)ALT" 가 400 이상인 값만 데이터프레임 형태로 추출해서 df_ASLT_high 라는 변수에 담습니다.
# 음주여부까지 함께 데이터를 살펴봅니다.


df_ASLT_high = df[(df["(혈청지오티)AST"] > 400) | (df["(혈청지오티)ALT"] > 400)]
sns.lmplot(data=df_ASLT_high, x="(혈청지오티)AST", y="(혈청지오티)ALT", hue="음주여부", ci=None)

```


```python
# 위에서 구한 df_ASLT_high 데이터 프레임에 담겨진 혈청지오티가 높은 데이터만 따로 봅니다.

df_ASLT_high_8000 = df_ASLT_high[df_ASLT_high["(혈청지오티)AST"] > 8000]
df_ASLT_high_8000.shape

```


```python
df_ASLT_high_8000.iloc[:, 10:27]
```

### distplot

- distplot은 히스토그램을 그려줍니다. 
- 히스토그램은 도수분포표에 따라 그림을 그리는 것을 말합니다. 계급에 따라 데이터의 개수를 세주는 것입니다.
- distplot은 결측치가 있으면 그릴 수 없습니다.



* [히스토그램 - 위키백과, 우리 모두의 백과사전](https://ko.wikipedia.org/wiki/%ED%9E%88%EC%8A%A4%ED%86%A0%EA%B7%B8%EB%9E%A8)
* [확률 밀도 함수 - 위키백과, 우리 모두의 백과사전](https://ko.wikipedia.org/wiki/%ED%99%95%EB%A5%A0_%EB%B0%80%EB%8F%84_%ED%95%A8%EC%88%98)


```python
 # Dtype 확인 수치형 / object

df.info()
```


```python
df["총콜레스테롤"].isnull().sum() # null 43 개 확인
```


```python
df["총콜레스테롤"].shape
```


```python
df_chol = df.loc[df["총콜레스테롤"].notnull(), "총콜레스테롤"] # null 값 제외하고 (43개) 불러오기
df_chol.head()
```


```python
df_chol.describe()
```


```python
# "총콜레스테롤" 에 따른 distplot 을 그립니다.
# 총콜레스테롤을 부드러운 곡선과 막대로 표현할 수 있습니다.
# 히스토그램은 막대를 나타내고, 히스토그램을 부드러운 곡선으로 처리해주는 것이 확률밀도함수입니다.



왜도와 첨도도 확인할 수 있습니다.
sns.distplot(df_chol)
```


```python
# bin으로 데이터를 몇 개로 나눠 담을 것인지를 설정할 수 있습니다.
# 이상치 때문에 그래프가 한 쪽으로 몰려있는 것을 볼 수 있습니다. 
# max 값이 지나치게 큽니다.

sns.distplot(df_chol, bins=10)

```


```python
# 음주여부가 1인 값에 대한 "총콜레스테롤 " 분포를 distplot 으로 그립니다.

sns.distplot(df.loc[df["총콜레스테롤"].notnull() & (df["음주여부"] == 1), "총콜레스테롤"])
```


```python
# 음주여부가 0인 값에 대한 "총콜레스테롤" 을 distplot 으로 그립니다.

sns.distplot(df.loc[
    df["총콜레스테롤"].notnull() & (df["음주여부"] == 0), "총콜레스테롤"])
```


```python
# 음주여부 값에 대한 "총콜레스테롤" 을 distplot 으로 그리며, 하나의 그래프에 표시되도록 합니다.

plt.axvline(df_sample["총콜레스테롤"].mean(), linestyle=":")
plt.axvline(df_sample["총콜레스테롤"].median(), linestyle="--")
sns.kdeplot(df_sample.loc[
    df_sample["총콜레스테롤"].notnull() & (df["음주여부"] == 1), 
    "총콜레스테롤"], label="음주 중")
sns.kdeplot(df_sample.loc[
    df_sample["총콜레스테롤"].notnull() & (df["음주여부"] == 0), 
    "총콜레스테롤"], label="음주 안 함")
```


```python
# 감마지티피 값에 따라 음주여부를 시각화 합니다.

s_1 = df_sample.loc[df_sample["음주여부"] == 1, "감마지티피"]
s_0 = df_sample.loc[df_sample["음주여부"] == 0, "감마지티피"]

sns.kdeplot(s_1, label="음주 중")
sns.kdeplot(s_0, label="음주 안 함")
```

## 상관 분석
* [상관 분석 - 위키백과, 우리 모두의 백과사전](https://ko.wikipedia.org/wiki/%EC%83%81%EA%B4%80_%EB%B6%84%EC%84%9D)


- 상관계수는 변수들 간의 관계를 알아볼 때 유용한 개념입니다. 
- 특정 데이터에 대한 상관관계를 볼 수 있습니다. 
- 상관계수는 -1부터 1사이로 구성되고, 0.3부터 0.7 사이면 뚜렷한 양적 선형관계, 0.7 이상이면 강한 양적 상관관계라 할 수 있습니다.

 



```
r이 -1.0과 -0.7 사이이면, 강한 음적 선형관계,
r이 -0.7과 -0.3 사이이면, 뚜렷한 음적 선형관계,
r이 -0.3과 -0.1 사이이면, 약한 음적 선형관계,
r이 -0.1과 +0.1 사이이면, 거의 무시될 수 있는 선형관계,
r이 +0.1과 +0.3 사이이면, 약한 양적 선형관계,
r이 +0.3과 +0.7 사이이면, 뚜렷한 양적 선형관계,
r이 +0.7과 +1.0 사이이면, 강한 양적 선형관계
```


```python
df.columns
```


```python
# 상관계수에 사용할 컬럼을 변수에 담습니다.
columns = ['연령대코드(5세단위)', '체중(5Kg단위)', '신장(5Cm단위)', '허리둘레', 
           '시력(좌)', '시력(우)', '청력(좌)', '청력(우)', 
           '수축기혈압', '이완기혈압', '식전혈당(공복혈당)', 
           '총콜레스테롤', '트리글리세라이드', 'HDL콜레스테롤', 'LDL콜레스테롤', '혈색소', '요단백', 
           '혈청크레아티닌', '(혈청지오티)AST', '(혈청지오티)ALT', '감마지티피', '흡연상태', '음주여부']


```


```python
len(columns)
```

### 상관계수 구하기


```python
# 샘플컬럼만 가져와서 df_small 이라는 데이터프레임에 담은 뒤 상관계수를 구합니다.

df_small = df_sample[columns]
df_corr  = df_small.corr() # 수치형 데이터만 연산



```


```python
# 키에 대한 상관계수가 특정 수치 이상인 데이터를 봅니다.

df_corr.loc[df_corr["신장(5Cm단위)"] > 0.1, "신장(5Cm단위)"]
```


```python
# 음주여부에 대한 상관계수가 특정 수치 이상인 데이터를 봅니다.
# 업데이트된 음주여부 데이터가 Y/N object 데이터 이므로 1/0 수치형 데이터로 변경 해줘야 합니다.
# df_corr.loc[df_corr["음주여부"] > 0.1, "음주여부"]

df_corr.loc[df_corr["음주여부"] > 0.25,"음주여부"]
```


```python
# 혈색소에 대한 상관계수가 특정 수치 이상인 데이터를 봅니다.
# 내림차순으로 정렬
df_corr["혈색소"].sort_values(ascending=False).head(7)
```


```python
# 감마지티피에 대한 상관계수가 특정 수치 이상인 데이터를 봅니다.
# 내림차순으로 정렬
df_corr["감마지티피"].sort_values(ascending=False).head(7)
```

### heatmap
* [Plotting a diagonal correlation matrix — seaborn 0.10.0 documentation](https://seaborn.pydata.org/examples/many_pairwise_correlations.html)


```python
# 위에서 구한 상관계수를 heatmap을 통해 표현해 봅니다.

plt.figure(figsize=(20, 7))
sns.heatmap(df_corr, annot=True, fmt=".2f", cmap="coolwarm")
```


```python
mask = np.triu(np.ones_like(df_corr, dtype=np.bool))

plt.figure(figsize=(20, 7))
sns.heatmap(df_corr, annot=True, fmt=".2f", cmap="coolwarm", mask=mask)
```


```python

```
